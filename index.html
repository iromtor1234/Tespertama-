<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Key Generator Mobile</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: url('https://i.ibb.co/0Jmshvb/mountain-pixel.png') center/cover no-repeat fixed;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    input, button {
      width: 90%;
      padding: 12px;
      margin: 6px 0;
      border: none;
      border-radius: 5px;
      font-size: 1em;
    }
    #adminPanel {
      position: fixed;
      top: 60px;
      right: 10px;
      background: rgba(0,0,0,0.7);
      padding: 10px;
      border-radius: 6px;
      max-height: 90%;
      overflow-y: auto;
      display: none;
    }
    #spinner {
      font-size: 1.2em;
    }
    #keyBox {
      white-space: pre-wrap;
      text-align: left;
    }
    button.small {
      padding: 6px 10px;
      font-size: 0.9em;
    }
  </style>
</head>
<body>

<button id="adminBtn" class="small" style="position:fixed;top:10px;right:10px;">Access Admin</button>

<h2 style="text-align:center;">Key Generator</h2>
<input type="password" id="passwordInput" placeholder="Masukkan Password">
<button id="generateBtn">Get Key</button>
<button id="buyKeyBtn">Buy Key</button>
<div id="spinner" style="display:none;">‚è≥ Loading...</div>
<div id="keyBox" style="display:none;"></div>
<div id="errorBox" style="display:none;color:red;"></div>
<button id="copyBtn" style="display:none;">Salin Key</button>

<div id="adminPanel">
  <strong>Admin Panel</strong><br>
  <div id="visitorBox" style="font-size:0.9em;margin-top:10px;"></div>
  <div id="countBox"></div>
  <hr>
  <div id="keyList"></div>
  <input type="text" id="editPwInput" placeholder="Password yg akan diedit">
  <input type="text" id="newKeyInput" placeholder="Key baru">
  <button id="editKeyBtn">Edit Key</button>
  <input type="text" id="deletePwInput" placeholder="Password yg akan dihapus">
  <button id="deleteKeyBtn">Delete Key</button>
  <input type="text" id="newPwInput" placeholder="Password baru">
  <input type="text" id="newAddKeyInput" placeholder="Key baru">
  <button id="addKeyBtn">Tambah Key</button>
  <button onclick="document.getElementById('adminPanel').style.display='none'">Tutup</button>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCldtyF1JSvBo4eBVBlYdI9pDAwM42Rb4M",
  authDomain: "rullweb.firebaseapp.com",
  databaseURL: "https://rullweb-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "rullweb",
  storageBucket: "rullweb.firebasestorage.app",
  messagingSenderId: "69407076508",
  appId: "1:69407076508:web:2f06036ef3785c65bb7d59"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let wrongAttempts = 0;
let isBlocked = false;
let entryCount = 0;

document.getElementById("generateBtn").addEventListener("click", function(){
  if (isBlocked) return;
  const pw = document.getElementById("passwordInput").value.trim();
  showSpinner(true);
  db.ref("visitorCount").transaction(count => (count || 0) + 1);
  db.ref("keys").orderByChild("password").equalTo(pw).once("value", snapshot => {
    showSpinner(false);
    if (snapshot.exists()) {
      const data = Object.values(snapshot.val())[0];
      entryCount++;
      showKey(`${entryCount}. Password: ${pw}\nGet Key: ${data.key}`);
      wrongAttempts = 0;
    } else {
      wrongAttempts++;
      showError("‚ùå Password salah!");
      if (wrongAttempts >= 3) {
        isBlocked = true;
        showError("‚ö†Ô∏è Salah 3x! Tunggu 10 detik...");
        disableInputs(true);
        setTimeout(() => {
          isBlocked = false; wrongAttempts = 0;
          disableInputs(false);
          hideError();
        }, 10000);
      }
    }
  });
});

document.getElementById("copyBtn").addEventListener("click", function(){
  const text = document.getElementById("keyBox").textContent;
  navigator.clipboard.writeText(text).then(() => alert("‚úÖ Key disalin!"));
});

document.getElementById("buyKeyBtn").addEventListener("click", function(){
  window.open("https://t.me/ARullReal", "_blank");
});

document.getElementById("adminBtn").addEventListener("click", function(){
  const pw = prompt("Masukkan password admin:");
  if (pw === "RullAdmin") {
    showAdminPanel();
  } else {
    alert("‚ùå Password admin salah!");
  }
});

document.getElementById("deleteKeyBtn").addEventListener("click", function(){
  const pwDel = document.getElementById("deletePwInput").value.trim();
  if (!pwDel) return alert("Masukkan password yg akan dihapus!");
  db.ref("keys").orderByChild("password").equalTo(pwDel).once("value", snapshot => {
    if (snapshot.exists()) {
      const key = Object.keys(snapshot.val())[0];
      db.ref("keys/"+key).remove();
      alert("‚úÖ Key dihapus!");
      listKeys();
    } else {
      alert("‚ùå Password tidak ditemukan!");
    }
  });
});

document.getElementById("editKeyBtn").addEventListener("click", function(){
  const pwEdit = document.getElementById("editPwInput").value.trim();
  const newKey = document.getElementById("newKeyInput").value.trim();
  if (!pwEdit || !newKey) return alert("Lengkapi field edit!");
  db.ref("keys").orderByChild("password").equalTo(pwEdit).once("value", snapshot => {
    if (snapshot.exists()) {
      const keyId = Object.keys(snapshot.val())[0];
      db.ref("keys/"+keyId).update({key: newKey});
      alert("‚úÖ Key diperbarui!");
      listKeys();
    } else {
      alert("‚ùå Password tidak ditemukan!");
    }
  });
});

document.getElementById("addKeyBtn").addEventListener("click", function(){
  const newPw = document.getElementById("newPwInput").value.trim();
  const newKey = document.getElementById("newAddKeyInput").value.trim();
  if (!newPw || !newKey) return alert("Lengkapi field tambah key!");
  db.ref("keys").push({ password: newPw, key: newKey });
  alert("‚úÖ Key baru ditambahkan!");
  listKeys();
});

function showAdminPanel(){
  document.getElementById("adminPanel").style.display = "block";
  trackVisitor();
  listKeys();
  db.ref("visitorCount").once("value", snap => {
    document.getElementById("countBox").textContent = `üë• Jumlah Pengunjung: ${snap.val() || 0}`;
  });
}

function showSpinner(show){
  document.getElementById("spinner").style.display = show ? "inline" : "none";
}
function showKey(text){
  const box = document.getElementById("keyBox");
  box.textContent = text;
  box.style.display = "block";
  document.getElementById("copyBtn").style.display = "inline";
}
function showError(msg){
  const box = document.getElementById("errorBox");
  box.textContent = msg;
  box.style.display = "block";
}
function hideError(){
  document.getElementById("errorBox").style.display = "none";
}
function disableInputs(dis){
  document.getElementById("generateBtn").disabled = dis;
  document.getElementById("passwordInput").disabled = dis;
}
function trackVisitor(){
  fetch("https://ipinfo.io?token=7004bb2c0f2233")
    .then(r => r.json())
    .then(data => {
      const info = `
        üåç IP: ${data.ip}<br>
        Negara: ${data.country}<br>
        Kota: ${data.city}<br>
        Region: ${data.region}<br>
        Org: ${data.org}<br>
      `;
      document.getElementById("visitorBox").innerHTML = info;
    })
    .catch(() => {
      document.getElementById("visitorBox").innerHTML = "‚ùå Gagal mengambil data visitor";
    });
}
function listKeys(){
  db.ref("keys").once("value", snap => {
    let html = "<strong>List Key:</strong><br>";
    snap.forEach(child => {
      const d = child.val();
      html += `üîë ${d.password} : ${d.key}<br>`;
    });
    document.getElementById("keyList").innerHTML = html;
  });
}
</script>

</body>
</html>
