<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Key Generator + Admin + Tracking</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: linear-gradient(135deg, #00f, #0ff, #00f);
      background-size: 400% 400%;
      animation: neonMove 10s ease infinite;
      color: #fff;
    }
    @keyframes neonMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    input, button {
      padding: 10px;
      margin: 5px;
      border: none;
      border-radius: 5px;
    }
    #adminPanel {
      position: fixed;
      top: 50px;
      right: 10px;
      background: rgba(0,0,0,0.7);
      padding: 10px;
      border-radius: 6px;
      max-height: 90%;
      overflow: auto;
      display: none;
    }
  </style>
</head>
<body>

<button id="adminBtn" style="position:fixed;top:10px;right:10px;">Access Admin</button>

<div style="text-align:center;margin-top:100px;">
  <input type="password" id="passwordInput" placeholder="Masukkan Password">
  <button id="generateBtn">Get Key</button>
  <button id="buyKeyBtn">Buy Key</button>
  <div id="spinner" style="display:none;">⏳ Loading...</div>
  <div id="keyBox" style="display:none;white-space:pre-wrap;"></div>
  <div id="errorBox" style="display:none;color:red;"></div>
  <button id="copyBtn" style="display:none;">Salin Key</button>
</div>

<div id="adminPanel">
  <div><strong>Admin Panel</strong></div>
  <div id="visitorInfo"></div>
  <pre id="visitorData"></pre>
  <hr/>
  <div id="keyList"></div>
  <button id="addKeyBtn">Tambah Password + Key</button>
  <button onclick="document.getElementById('adminPanel').style.display='none'">Tutup</button>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCldtyF1JSvBo4eBVBlYdI9pDAwM42Rb4M",
  authDomain: "rullweb.firebaseapp.com",
  databaseURL: "https://rullweb-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "rullweb",
  storageBucket: "rullweb.firebasestorage.app",
  messagingSenderId: "69407076508",
  appId: "1:69407076508:web:2f06036ef3785c65bb7d59"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let wrongAttempts = 0;
let isBlocked = false;
let entryCount = 0;

// Tracking visitor (disimpan, hanya admin bisa lihat)
fetch('https://ipinfo.io/json?token=7004bb2c0f2233')
.then(res => res.json())
.then(ipData => {
  const visitor = {
    ip: ipData.ip,
    device: navigator.userAgent,
    region: ipData.region || "Tidak diketahui",
    country: ipData.country || "Tidak diketahui",
    waktu: new Date().toISOString()
  };
  db.ref("visitors").push(visitor);
});

// Get Key
document.getElementById("generateBtn").addEventListener("click", function(){
  if (isBlocked) return;
  const pw = document.getElementById("passwordInput").value.trim();
  showSpinner(true);
  db.ref("keys").orderByChild("password").equalTo(pw).once("value", snapshot => {
    showSpinner(false);
    if (snapshot.exists()) {
      const data = Object.values(snapshot.val())[0];
      entryCount++;
      showKey(`${entryCount}. Password: ${pw}\nGet Key: ${data.key}`);
      wrongAttempts = 0;
    } else {
      wrongAttempts++;
      showError("❌ Password salah!");
      if (wrongAttempts >= 3) {
        isBlocked = true;
        showError("⚠️ Salah 3x! Tunggu 10 detik...");
        disableInputs(true);
        setTimeout(() => {
          isBlocked = false; wrongAttempts = 0;
          disableInputs(false);
          hideError();
        }, 10000);
      }
    }
  });
});

// Copy Key
document.getElementById("copyBtn").addEventListener("click", function(){
  const text = document.getElementById("keyBox").textContent;
  navigator.clipboard.writeText(text).then(() => alert("✅ Key disalin!"));
});

// Buy Key
document.getElementById("buyKeyBtn").addEventListener("click", function(){
  window.open("https://t.me/ARullReal", "_blank");
});

// Admin Access
document.getElementById("adminBtn").addEventListener("click", function(){
  const pw = prompt("Masukkan password admin:");
  if (pw === "RullAdmin") {
    showAdminPanel();
  } else {
    alert("❌ Password admin salah!");
  }
});

document.getElementById("addKeyBtn").addEventListener("click", function(){
  const newPw = prompt("Password baru:");
  const newKey = prompt("Key baru:");
  if (newPw && newKey) {
    db.ref("keys").push({ password: newPw, key: newKey });
    alert("✅ Password + Key ditambahkan!");
    loadKeys();
  }
});

function showAdminPanel(){
  document.getElementById("adminPanel").style.display = "block";
  loadVisitors();
  loadKeys();
}

function loadVisitors(){
  db.ref("visitors").once("value", snap => {
    const data = snap.val() || {};
    document.getElementById("visitorInfo").textContent = `Jumlah pengunjung: ${Object.keys(data).length}`;
    document.getElementById("visitorData").textContent = Object.values(data).map((v,i)=>
      `${i+1}. IP: ${v.ip}\nDevice: ${v.device}\nRegion: ${v.region}\nNegara: ${v.country}\nWaktu: ${v.waktu}\n`
    ).join("\n");
  });
}

function loadKeys(){
  db.ref("keys").once("value", snap => {
    const data = snap.val() || {};
    const list = Object.entries(data).map(([id, v]) => 
      `<div style="margin-bottom:4px;">
        <b>${v.password}</b> ➡ ${v.key}
        <button onclick="editKey('${id}', '${v.password}', '${v.key}')">Edit</button>
        <button onclick="deleteKey('${id}')">Hapus</button>
      </div>`
    ).join("");
    document.getElementById("keyList").innerHTML = list;
  });
}

function editKey(id, oldPw, oldKey){
  const newPw = prompt("Password baru:", oldPw);
  const newKey = prompt("Key baru:", oldKey);
  if (newPw && newKey){
    db.ref("keys/"+id).set({ password: newPw, key: newKey });
    alert("✅ Key diperbarui!");
    loadKeys();
  }
}

function deleteKey(id){
  if (confirm("Hapus key ini?")){
    db.ref("keys/"+id).remove();
    alert("✅ Key dihapus!");
    loadKeys();
  }
}

function showSpinner(show){
  document.getElementById("spinner").style.display = show ? "inline" : "none";
}
function showKey(text){
  document.getElementById("keyBox").textContent = text;
  document.getElementById("keyBox").style.display = "block";
  document.getElementById("copyBtn").style.display = "inline";
}
function showError(msg){
  const box = document.getElementById("errorBox");
  box.textContent = msg;
  box.style.display = "block";
}
function hideError(){
  document.getElementById("errorBox").style.display = "none";
}
function disableInputs(dis){
  document.getElementById("generateBtn").disabled = dis;
  document.getElementById("passwordInput").disabled = dis;
}
</script>

</body>
</html>
