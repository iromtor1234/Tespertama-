<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RGB Key Generator</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      font-family: sans-serif;
      color: #fff;
    }
    canvas {
      position: fixed;
      top: 0; left: 0;
      z-index: -1;
    }
    .container {
      position: relative;
      z-index: 1;
      text-align: center;
      padding: 20px;
    }
    input, button {
      padding: 10px;
      border: none;
      border-radius: 5px;
      margin: 5px 0;
      font-size: 1em;
      width: 90%;
      max-width: 300px;
    }
    #keyBox, #errorBox {
      margin-top: 10px;
      padding: 10px;
      border-radius: 5px;
    }
    #keyBox {
      background: rgba(0,0,0,0.5);
    }
    #errorBox {
      background: rgba(255,0,0,0.5);
    }
    #adminPanel {
      position: fixed;
      top: 50px;
      right: 10px;
      background: rgba(0,0,0,0.7);
      padding: 10px;
      border-radius: 6px;
      display: none;
      max-height: 90%;
      overflow-y: auto;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
<canvas id="bg"></canvas>

<div class="container">
  <button id="adminBtn" style="position:fixed;top:10px;right:10px;">Access Admin</button>
  <h2>RGB Key Generator</h2>
  <input type="password" id="passwordInput" placeholder="Masukkan Password">
  <button id="togglePwBtn">üëÅ</button><br>
  <button id="generateBtn">Get Key</button>
  <button id="buyKeyBtn">Buy Key</button>
  <div id="spinner" style="display:none;">‚è≥ Loading...</div>
  <div id="keyBox" style="display:none;"></div>
  <div id="errorBox" style="display:none;"></div>
  <button id="copyBtn" style="display:none;">Salin Key</button>
</div>

<div id="adminPanel">
  <strong>Admin Panel</strong><br>
  <div id="visitorBox"></div>
  <div id="countBox"></div>
  <hr>
  <div id="keyList"></div>
  <input type="text" id="editPwInput" placeholder="Password yg akan diedit">
  <input type="text" id="newKeyInput" placeholder="Key baru">
  <button id="editKeyBtn">Edit Key</button>
  <input type="text" id="deletePwInput" placeholder="Password yg akan dihapus">
  <button id="deleteKeyBtn">Delete Key</button>
  <input type="text" id="newPwInput" placeholder="Password baru">
  <input type="text" id="newAddKeyInput" placeholder="Key baru">
  <button id="addKeyBtn">Tambah Key</button>
  <button onclick="document.getElementById('adminPanel').style.display='none'">Tutup</button>
</div>

<script>
// Firebase
const firebaseConfig = {
  apiKey: "AIzaSyCldtyF1JSvBo4eBVBlYdI9pDAwM42Rb4M",
  authDomain: "rullweb.firebaseapp.com",
  databaseURL: "https://rullweb-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "rullweb",
  storageBucket: "rullweb.firebasestorage.app",
  messagingSenderId: "69407076508",
  appId: "1:69407076508:web:2f06036ef3785c65bb7d59"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let wrongAttempts = 0, isBlocked = false, entryCount = 0;

// RGB background
const c = document.getElementById("bg"), ctx = c.getContext("2d");
c.width = window.innerWidth; c.height = window.innerHeight;
window.onresize = ()=>{c.width=window.innerWidth;c.height=window.innerHeight;}
let hue = 0;
function drawBG(){
  ctx.fillStyle = `hsl(${hue},100%,50%)`;
  ctx.fillRect(0,0,c.width,c.height);
  hue = (hue + 0.5) % 360;
  requestAnimationFrame(drawBG);
}
drawBG();

// Main logic
document.getElementById("generateBtn").addEventListener("click", ()=>{
  if(isBlocked) return;
  const pw = passwordInput.value.trim();
  showSpinner(true);
  db.ref("visitorCount").transaction(c=> (c||0)+1);
  db.ref("keys").orderByChild("password").equalTo(pw).once("value", snap=>{
    showSpinner(false);
    if(snap.exists()){
      const data = Object.values(snap.val())[0];
      entryCount++;
      showKey(`${entryCount}. Password: ${pw}\nGet Key: ${data.key}`);
      wrongAttempts=0;
    } else {
      wrongAttempts++;
      showError("‚ùå Password salah!");
      if(wrongAttempts>=3){
        isBlocked=true;
        showError("‚ö†Ô∏è Salah 3x! Tunggu 10 detik...");
        disableInputs(true);
        setTimeout(()=>{isBlocked=false;wrongAttempts=0;disableInputs(false);hideError();},10000);
      }
    }
  });
});

document.getElementById("copyBtn").addEventListener("click",()=>{
  const text = keyBox.textContent;
  navigator.clipboard.writeText(text).then(()=>alert("‚úÖ Key disalin!"));
});

document.getElementById("togglePwBtn").addEventListener("click",()=>{
  if(passwordInput.type==="password"){
    passwordInput.type="text"; togglePwBtn.textContent="üôà";
  } else {
    passwordInput.type="password"; togglePwBtn.textContent="üëÅ";
  }
});

document.getElementById("buyKeyBtn").addEventListener("click",()=>{
  window.open("https://t.me/ARullReal","_blank");
});

document.getElementById("adminBtn").addEventListener("click",()=>{
  const pw = prompt("Masukkan password admin:");
  if(pw==="RullAdmin") showAdminPanel();
  else alert("‚ùå Salah password admin!");
});

document.getElementById("deleteKeyBtn").addEventListener("click",()=>{
  const pw = deletePwInput.value.trim();
  if(!pw)return alert("Isi password yg dihapus!");
  db.ref("keys").orderByChild("password").equalTo(pw).once("value",snap=>{
    if(snap.exists()){
      const id=Object.keys(snap.val())[0];
      db.ref("keys/"+id).remove();
      alert("‚úÖ Key dihapus!"); listKeys();
    } else alert("‚ùå Tidak ditemukan!");
  });
});

document.getElementById("editKeyBtn").addEventListener("click",()=>{
  const pw=editPwInput.value.trim(), key=newKeyInput.value.trim();
  if(!pw||!key)return alert("Lengkapi field edit!");
  db.ref("keys").orderByChild("password").equalTo(pw).once("value",snap=>{
    if(snap.exists()){
      const id=Object.keys(snap.val())[0];
      db.ref("keys/"+id).update({key:key});
      alert("‚úÖ Key diupdate!"); listKeys();
    } else alert("‚ùå Tidak ditemukan!");
  });
});

document.getElementById("addKeyBtn").addEventListener("click",()=>{
  const pw=newPwInput.value.trim(), key=newAddKeyInput.value.trim();
  if(!pw||!key)return alert("Lengkapi field tambah!");
  db.ref("keys").push({password:pw,key:key});
  alert("‚úÖ Key ditambah!"); listKeys();
});

// Helper
function showSpinner(s){spinner.style.display=s?"block":"none";}
function showKey(t){keyBox.textContent=t;keyBox.style.display="block";copyBtn.style.display="block";}
function showError(t){errorBox.textContent=t;errorBox.style.display="block";}
function hideError(){errorBox.style.display="none";}
function disableInputs(b){generateBtn.disabled=b;passwordInput.disabled=b;}
function showAdminPanel(){
  adminPanel.style.display="block"; trackVisitor(); listKeys();
  db.ref("visitorCount").once("value",snap=>{countBox.textContent=`üë• Pengunjung: ${snap.val()||0}`;});
}
function listKeys(){
  db.ref("keys").once("value",snap=>{
    let html="üîë List:<br>";
    snap.forEach(c=>{const d=c.val();html+=`${d.password}:${d.key}<br>`;});
    keyList.innerHTML=html;
  });
}
function trackVisitor(){
  fetch("https://ipinfo.io?token=7004bb2c0f2233")
    .then(r=>r.json()).then(d=>{
      visitorBox.innerHTML=`üåç IP: ${d.ip}<br>Negara: ${d.country}<br>Kota: ${d.city}<br>Org: ${d.org}`;
    })
    .catch(()=>visitorBox.innerHTML="‚ùå Gagal tracking");
}
</script>
</body>
</html>
